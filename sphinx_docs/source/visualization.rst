*************
Visualization
*************

There are a large number of tools that can be used to read in Castro
or AMReX data and make plots. Here we give a brief overview of some of
the tools as well as some examples.

Controlling What’s in the PlotFile
==================================

There are a few options that can be set at runtime to control what
variables appear in the plotfile.

  * ``amr.plot_vars``: this controls which of the main
    state variables appear in the plotfile. The default is for all of
    them to be stored. But you can specify a subset by name, e.g.::

        amr.plot_vars = density

    to only store that subset.

  * ``amr.derive_plot_vars``: this controls which of the derived
    variables to be stored in the plotfile. Derived variables are
    created only when the plotfile is being created, using the
    infrastructure provided by AMReX to register variables and the
    associated Fortran routine to do the deriving (``Derive_nd.F90``).

    By default, no derived variables are stored. You can store all
    derived variables that Castro knows about by doing::

       amr.derive_plot_vars = ALL

   or a subset by explicitly listing them, e.g.::

      amr.derive_plot_vars = entropy pressure


Plotfile Variables
==================

Native variables
----------------

These variables come directly from the ``StateData``, either the
``State_Type`` (for the hydrodynamic variables) or ``Reactions_Type``
(for the nuclear energy generation quantities)


+-----------------------------------+---------------------------------------------------+--------------------------------------+
| variable name                     | description                                       | units                                |
+===================================+===================================================+======================================+
| ``density``                       | Mass density                                      | :math:`\gcc`                         |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``xmom``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``ymom``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``zmom``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rho_E``                         | Total energy density                              | :math:`{\rm erg~cm^{-3}}`            |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rho_e``                         | Internal energy density                           | :math:`{\rm erg~cm^{-3}}`            |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``Temp``                          | Temperature                                       | :math:`{\rm K}`                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rho_`` X                        | Mass density of species X                         | :math:`\gcc`                         |
| (where X is any of the species    |                                                   |                                      |
| defined in the network)           |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``omegadot_ar36``                 |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``enuc``                          | Nuclear energy generation rate / gram             | :math:`{\rm erg~g^{-1}~s^{-1}}`      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rho_enuc``                      | Nuclear energy generation rate density            | :math:`{\rm erg~cm^{-3}~s^{-1}}`     |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``phiGrav``                       |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``grav_x``, ``grav_y``,           | Gravitational acceleration                        | :math:`{\rm cm~s^{-2}}`              |
| ``grav_z``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``phiRot``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rot_x``. ``rot_y``, ``rot_z``   |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+



Derived variables
-----------------

+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| variable name                     | description                                       | derive routine              | units                                |
+===================================+===================================================+=============================+======================================+
| ``angular_momentum_x``,           | Angular momentum / volume in the x, y, or z dir   | ``derangmomx``,             |                                      |
| ``angular_momentum_y``,           | computed as :math:`[(\rho \ub) \times {\bf r}]_n` | ``derangmomy``,             |                                      |
| ``angular_momentum_z``            | where :math:`{\bf r}` is the distance from the    | ``derangmomz``              |                                      |
|                                   | origin and :math:`n` is either x, y, or z         |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``diff_coeff``                    | Thermal diffusion coefficient,                    | ``derdiffcoeff``            |                                      |
|                                   | :math:`\kth/(\rho c_v)`                           |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``diff_term``                     | :math:`\nabla\cdot(\kth\nabla T)`                 | ``derdiffterm``             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``divu``                          | :math:`\nabla \cdot \ub`                          | ``derdivu``                 | :math:`{\rm s^{-1}}`                 |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``eint_e``                        | Specific internal energy computed from the        | ``dereint2``                | :math:`{\rm erg~g^{-1}}`             |
|                                   | conserved :math:`(\rho e)` state variable as      |                             |                                      |
|                                   | :math:`e = (\rho e)/\rho`                         |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``eint_E``                        | Specific internal energy computed from the        | ``dereint1``                | :math:`{\rm erg~g^{-1}}`             |
|                                   | total energy and momentum conserved state as      |                             |                                      |
|                                   | :math:`e = (\rho E)-\frac{1}{2}(\rho \ub^2)/\rho` |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``entropy``                       | Specific entropy, :math:`s`, computed as          | ``derentropy``              | :math:`{\rm erg~g^{-1}~K^{-1}}`      |
|                                   | :math:`s = s(\rho, e, X_k)`, where `e` is         |                             |                                      |
|                                   | computed from :math:`(\rho e)`                    |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``Ertot``                         | Total radiation energy density                    | ``derertot``                |                                      |
|                                   | (for multigroup radiation problems)               |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``Frcomx``, ``Frcomy``,           | Comoving radiation flux                           | ``Radiation.cpp``           |                                      |
| ``Frcomz``                        |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``Frlabx``, ``Frlaby``,           | Lab-frame radiation flux                          | ``Radiation.cpp``           |                                      |
| ``Frlabz``                        |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``Gamma_1``                       | Adiabatic index,                                  | ``dergamma1``               | --                                   |
|                                   | :math:`d\log p/d\log \rho|_s`                     |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``kineng``                        | Kinetic energy density,                           | ``derkineng``               | :math:`{\rm erg~cm^{-3}}`            |
|                                   | :math:`K = \frac{1}{2} |(\rho \ub)|^2`            |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``lambda``                        |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``lmom``                          |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+

| ``logden``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``MachNumber``                    |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``maggrav``                       |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``magmom``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``magvel``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``magvort``                       |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``phiEff``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``phiEffPM_P``                    |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``phiEffPM_S``                    |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``pmom``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``pressure``                      |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rad``                           |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rad0``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``radvel``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``rmom``                          |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``Shock``                         |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``soundspeed``                    |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``StateErr``                      |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``thermal_cond``                  |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``tpert``                         |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``t_sound_t_enuc``                |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``uminusc``                       |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``uplusc``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``X(ar36)``                       |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``x_velocity``,                   |                                                   |                                      |
| ``y_velocity``,                   |                                                   |                                      |
| ``z_velocity``                    |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+


problem-specific plotfile variables
-----------------------------------

+-----------------------------------+---------------------------------------------------+--------------------------------------+
| variable name                     | description                                       | units                                |
+===================================+===================================================+======================================+
| ``analytic``                      |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``pi``                            |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``pioverp0``                      |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``primarymask``                   |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``secondarymask``                 |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``Terror``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``Texact``                        |                                                   |                                      |
+-----------------------------------+---------------------------------------------------+--------------------------------------+
| ``inertial_angular_momentum_x``,  |                                                   |                             |                                      |
| ``inertial_angular_momentum_y``,  |                                                   |                             |                                      |
| ``inertial_angular_momentum_z``   |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``inertial_momentum_x``,          |                                                   |                             |                                      |
| ``inertial_momentum_y``,          |                                                   |                             |                                      |
| ``inertial_momentum_z``           |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+
| ``inertial_radial_momentum_x``,   |                                                   |                             |                                      |
| ``inertial_radial_momentum_y``,   |                                                   |                             |                                      |
| ``inertial_radial_momentum_z``    |                                                   |                             |                                      |
+-----------------------------------+---------------------------------------------------+-----------------------------+--------------------------------------+



Visualization Tools
===================

.. toctree::

   vis_tools


